// nRF5340 DK - GPS Display Application Overlay
// Target: nRF5340 Application Core (nrf5340dk/nrf5340/cpuapp)
// Peripherals: GPS UART1 + ILI9341 TFT Display

// Disable unused peripherals
&spi0 { status = "disabled"; };
&i2c0 { status = "disabled"; };
&i2c1 { status = "disabled"; };
&i2c2 { status = "disabled"; };

// SPI4 for TFT Display
&spi4 {
    status = "okay";
    pinctrl-0 = <&spi4_default>;
    pinctrl-1 = <&spi4_sleep>;
    pinctrl-names = "default", "sleep";
    cs-gpios = <&gpio1 12 GPIO_ACTIVE_LOW>;  // P1.12 as TFT CS
};

/* Pinctrl configurations */
&pinctrl {
    spi4_default: spi4_default {
        group1 {
            psels = <NRF_PSEL(SPIM_SCK, 1, 15)>,   // P1.15 SCLK
                    <NRF_PSEL(SPIM_MOSI, 1, 13)>,  // P1.13 MOSI
                    <NRF_PSEL(SPIM_MISO, 1, 14)>;  // P1.14 MISO
         };
    };

    spi4_sleep: spi4_sleep {
        group1 {
            psels = <NRF_PSEL(SPIM_SCK, 1, 15)>,
                    <NRF_PSEL(SPIM_MOSI, 1, 13)>,
                    <NRF_PSEL(SPIM_MISO, 1, 14)>;
            low-power-enable;
        };
    };

    uart1_gps: uart1_gps {
        group1 {
            psels = <NRF_PSEL(UART_TX, 0, 20)>,  // P0.20 UART1 TX (to GPS RX)
                    <NRF_PSEL(UART_RX, 0, 22)>;  // P0.22 UART1 RX (from GPS TX)
        };
    };

    uart1_gps_sleep: uart1_gps_sleep {
        group1 {
            psels = <NRF_PSEL(UART_TX, 0, 20)>,
                    <NRF_PSEL(UART_RX, 0, 22)>;
            low-power-enable;
        };
    };
};

/ {
    aliases {
        gps-uart = &uart1;
    };

    chosen {
        zephyr,display = &ili9341;
    };

    mipi_dbi {
        compatible = "zephyr,mipi-dbi-spi";
        spi-dev = <&spi4>;
        dc-gpios = <&gpio1 11 GPIO_ACTIVE_HIGH>;    // P1.11 DC
        reset-gpios = <&gpio1 10 GPIO_ACTIVE_LOW>;  // P1.10 RESET
        status = "okay";
        #address-cells = <1>;
        #size-cells = <0>;

        ili9341: ili9341@0 {
            compatible = "ilitek,ili9341";
            reg = <0>;
            mipi-max-frequency = <25000000>;
            width = <240>;
            height = <320>;
            rotation = <90>;  // Landscape mode: 320x240
            gamset = [01];
        };
    };
};

// UART1 for GPS (9600 baud)
&uart1 {
    compatible = "nordic,nrf-uarte";
    status = "okay";
    current-speed = <9600>;
    pinctrl-0 = <&uart1_gps>;
    pinctrl-1 = <&uart1_gps_sleep>;
    pinctrl-names = "default", "sleep";
};

/// Pin Mapping Summary:
// GPS UART1:
//   P0.20 - UART TX  (connect to GPS RX)
//   P0.22 - UART RX  (connect from GPS TX)
//
// TFT Display (SPI4):
//   P1.15 - SCK      (Shared SPI4 CLK)
//   P1.13 - MOSI     (Shared SPI4 MOSI)
//   P1.14 - MISO     (Shared SPI4 MISO)
//   P1.12 - TFT CS   (ILI9341 Display CS)
//   P1.11 - DC       (ILI9341 Display DC)
//   P1.10 - RESET    (ILI9341 Display Reset)
